.MODEL SMALL
.STACK 100H
.DATA
 

MOLTIPLICATORE_10 DW 10
DIVISORE_BINARIO DW 2
NUM_DEC DW ?
NUM_BIN DB ?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,"$" 
LUNGHEZZA EQU $-NUM_BIN

;DICHIARAZIONE STRINGHE

INTRO DB "Benvenuti nel convertitore Decimale-Binario","$"
STRINGA_INPUT DB "Inserire il numero decimale: ","$"
STRINGA_OUTPUT DB "Il numero convertito in binario e': ","$"


.CODE
 

MOV AX,@DATA
MOV DS,AX


MOV AH,09h
LEA SI,INTRO
MOV DX,SI
INT 21H
MOV AH,02h
MOV DX,13
INT 21h
MOV AH,02H
MOV DX,10
INT 21h 
MOV AH,02h
MOV DX,13
INT 21h
MOV AH,02H
MOV DX,10
INT 21h
MOV AH,09h
LEA SI,STRINGA_INPUT
MOV DX,SI
INT 21h
 

INPUT:


MOV AH,01h
INT 21h

;CONTROLLI INPUT
CMP AL,13
JE TERMINA_INPUT

CMP AL,8
JE ELIMINA_INSERIMENTO_NUMERICO

CMP AL,'0'
JGE OK_0

JMP ELIMINA_INSERIMENTO

OK_0:
CMP AL,'9'
JLE OK_9

JMP ELIMINA_INSERIMENTO

OK_9:
 
MOV AH,0h
PUSH AX
MOV AX,BX
MUL MOLTIPLICATORE_10
MOV BX,AX
POP AX
SUB AX,30h
ADD BX,AX

JMP INPUT

;SE E' STATO PREMUTO BACKSPACE, L'INSERIMENTO VIENE ANNULLATO.

ELIMINA_INSERIMENTO_NUMERICO:
MOV DL,8
MOV AH,02H
INT 21H
MOV DL,' '
MOV AH,02H
INT 21H
MOV DL,8
MOV AH,02H
INT 21H
MOV AX,BX  
MOV DX,0
DIV MOLTIPLICATORE_10 
MOV BX,AX
JMP INPUT 

ELIMINA_INSERIMENTO:
 

MOV DL,8
MOV AH,02H
INT 21H
MOV DL,' '
MOV AH,02H
INT 21H
MOV DL,8
MOV AH,02H
INT 21H 
JMP INPUT


TERMINA_INPUT:

MOV NUM_DEC,BX

MOV SI,LUNGHEZZA
DEC SI
MOV AX,NUM_DEC
 

CALCOLA_NUMERO:
CMP SI,0
JE OUTPUT


DIV DIVISORE_BINARIO
MOV DH,0h
MOV NUM_BIN[SI],DL
ADD NUM_BIN[SI],30h
SUB SI,1

JMP CALCOLA_NUMERO 

OUTPUT:

MOV AH,02h
MOV DX,13
INT 21h
MOV AH,02H
MOV DX,10
INT 21h
MOV AH,02h
MOV DX,13
INT 21h
MOV AH,02H
MOV DX,10
INT 21h

LEA SI,STRINGA_OUTPUT
MOV DX,SI
MOV AH,09h
INT 21H

MOV SI,0

STAMPA:
CMP SI,LUNGHEZZA
JGE FINE

MOV DH,0h
MOV DL,NUM_BIN[SI] 
MOV AH,02h
INT 21h
INC SI

JMP STAMPA

FINE:

MOV AX,4C00h
INT 21h


END